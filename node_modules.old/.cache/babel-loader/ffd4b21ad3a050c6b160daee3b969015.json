{"ast":null,"code":"import _classCallCheck from \"D:\\\\actions\\\\st_frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\actions\\\\st_frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\actions\\\\st_frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\actions\\\\st_frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\actions\\\\st_frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"D:\\\\actions\\\\st_frontend\\\\src\\\\components\\\\ButtonImportXLS.js\";\n// DATA \nimport Model from '../model/model'; // LIBS \n\nimport XLSX from 'xlsx';\nimport React, { Component } from 'react';\nimport { Input, Button, Row, Col } from 'reactstrap';\nimport BenMessage from './BenMessage';\nimport ViewModal from './ViewModal';\nimport BenTable from './BenTable';\n\nArray.prototype.equals = function (array) {\n  // if the other array is a falsy value, return\n  if (!array) return false; // compare lengths - can save a lot of time \n\n  if (this.length != array.length) return false;\n\n  for (var i = 0, l = this.length; i < l; i++) {\n    // Check if we have nested arrays\n    if (this[i] instanceof Array && array[i] instanceof Array) {\n      // recurse into the nested arrays\n      if (!this[i].equals(array[i])) return false;\n    } else if (this[i] != array[i]) {\n      // Warning - two different object instances will never be equal: {x:20} != {x:20}\n      return false;\n    }\n  }\n\n  return true;\n};\n\nvar ButtonImportXLS =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ButtonImportXLS, _Component);\n\n  function ButtonImportXLS(props) {\n    var _this;\n\n    _classCallCheck(this, ButtonImportXLS);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ButtonImportXLS).call(this, props));\n    _this._index = 0;\n    _this._percentage = 0;\n\n    _this._onSubmit = function () {\n      _this._index = 0;\n      _this._percentage = 0;\n\n      _this._uploadNow();\n    };\n\n    _this.state = {\n      status: '',\n      columns: props.columns,\n      isOpen: false\n    };\n    _this.grid = {\n      colums: [],\n      rowData: []\n    };\n\n    _this._setup();\n\n    return _this;\n  }\n\n  _createClass(ButtonImportXLS, [{\n    key: \"_setup\",\n    value: function _setup() {\n      var _this2 = this;\n\n      // FORMAT GRID COLUM\n      this.state.columns.map(function (item) {\n        _this2.grid.colums.push({\n          headerName: item,\n          field: item,\n          width: '140px'\n        });\n      });\n      this.model = new Model(this.props.strModel);\n    }\n  }, {\n    key: \"_openForm\",\n    value: function _openForm() {\n      this.setState({\n        isOpen: true\n      });\n    }\n  }, {\n    key: \"_compareColumns\",\n    value: function _compareColumns() {\n      var columns = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      return columns.equals(this.state.columns);\n    }\n  }, {\n    key: \"_handleFile\",\n    value: function _handleFile(e) {\n      var _this3 = this;\n\n      if (e.target.files && e.target.files.length > 0) {\n        var msg = 'Định dạng cột trong tập tin Excel không hợp lệ';\n        var reader = new FileReader();\n        reader.readAsArrayBuffer(e.target.files[0]);\n\n        reader.onload = function (e) {\n          var data = new Uint8Array(reader.result);\n          var wb = XLSX.read(data, {\n            type: 'array'\n          });\n          var sheetName = wb.SheetNames[0];\n          var worksheet = wb.Sheets[sheetName];\n          var list = XLSX.utils.sheet_to_json(worksheet, {\n            raw: true\n          });\n\n          if (list.length > 0) {\n            if (_this3._compareColumns(Object.keys(list[0]))) {\n              _this3.grid.rowData = list;\n\n              _this3._openForm();\n\n              msg = '';\n            }\n          }\n\n          if (msg !== '') {\n            BenMessage({\n              message: msg\n            });\n          }\n        };\n      }\n    }\n  }, {\n    key: \"_uploadNow\",\n    value: function _uploadNow() {\n      var _this4 = this;\n\n      var data = this.grid.rowData[this._index];\n\n      if (this._index < this.grid.rowData.length) {\n        this.model.axios('post', data, function (res) {\n          _this4._index += 1;\n          _this4._percentage = _this4._index * 100 / _this4.grid.rowData.length;\n\n          _this4.setState({\n            status: res.name\n          });\n\n          _this4._uploadNow();\n        });\n      } else {\n        BenMessage({\n          message: 'Đã upload thành công'\n        });\n        this.setState({\n          status: 'finish',\n          isOpen: false\n        });\n        this.props.onComplete(true);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this5 = this;\n\n      return React.createElement(Button, {\n        style: this.props.style,\n        className: \"btn btn-normal\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 173\n        },\n        __self: this\n      }, React.createElement(ViewModal, {\n        width: this.props.width,\n        name: this.props.strModel,\n        isOpen: this.state.isOpen,\n        onToggle: function onToggle(isOpen) {\n          _this5.setState({\n            isOpen: isOpen\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"view-modal-body\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180\n        },\n        __self: this\n      }, React.createElement(BenTable, {\n        height: this.props.height,\n        grid: this.grid,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        style: {\n          marginTop: 20\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, React.createElement(Row, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, React.createElement(Col, {\n        md: 1,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, React.createElement(Button, {\n        onClick: this._onSubmit,\n        className: \"btn btn-normal bg-green\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        className: \"fa fa-cloud-upload\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }), \" T\\u1EA3i l\\xEAn\")), React.createElement(Col, {\n        md: 11,\n        style: {\n          margin: 'auto'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        style: {\n          display: this.state.status === '' ? 'none' : 'block'\n        },\n        className: \"progress progress-sm \",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"progress-bar progress-bar-success progress-bar-striped\",\n        style: {\n          width: this._percentage + '%'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }, React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, \" \", Math.floor(this._percentage) + '%', \" Complete\")))))))), React.createElement(\"i\", {\n        className: this.props.icon,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 212\n        },\n        __self: this\n      }), \" \", this.props.title, React.createElement(Input, {\n        accept: \".xlsx\",\n        style: {\n          width: '100%',\n          height: 50,\n          position: 'absolute',\n          top: 0,\n          left: 15,\n          opacity: 0\n        },\n        id: \"photo\",\n        type: \"file\",\n        onChange: function onChange(e) {\n          _this5._handleFile(e);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return ButtonImportXLS;\n}(Component);\n\nButtonImportXLS.defaultProps = {\n  onComplete: function onComplete(isSuccess) {},\n  strModel: 'products',\n  columns: ['code', 'name', 'type', 'supplier_codes', 'price_1', 'price_2', 'price_3', 'price_4', 'is_serial'],\n  icon: \"fa fa-cloud-upload mr-5\",\n  title: '.xlsx',\n  width: '81%',\n  height: '55vh'\n};\nexport default ButtonImportXLS;","map":{"version":3,"sources":["D:/actions/st_frontend/src/components/ButtonImportXLS.js"],"names":["Model","XLSX","React","Component","Input","Button","Row","Col","BenMessage","ViewModal","BenTable","Array","prototype","equals","array","length","i","l","ButtonImportXLS","props","_index","_percentage","_onSubmit","_uploadNow","state","status","columns","isOpen","grid","colums","rowData","_setup","map","item","push","headerName","field","width","model","strModel","setState","e","target","files","msg","reader","FileReader","readAsArrayBuffer","onload","data","Uint8Array","result","wb","read","type","sheetName","SheetNames","worksheet","Sheets","list","utils","sheet_to_json","raw","_compareColumns","Object","keys","_openForm","message","axios","res","name","onComplete","style","height","marginTop","margin","display","Math","floor","icon","title","position","top","left","opacity","_handleFile","defaultProps","isSuccess"],"mappings":"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","sourcesContent":["// DATA \r\nimport Model from '../model/model';\r\n// LIBS \r\nimport XLSX from 'xlsx';\r\n\r\n\r\nimport React, { Component } from 'react';\r\nimport { Input, Button, Row, Col } from 'reactstrap';\r\n\r\n\r\nimport BenMessage from './BenMessage'; \r\nimport ViewModal  from './ViewModal';\r\nimport BenTable from './BenTable' ; \r\n\r\n\r\n \r\n\r\nArray.prototype.equals = function (array) {\r\n    // if the other array is a falsy value, return\r\n    if (!array)\r\n        return false;\r\n\r\n    // compare lengths - can save a lot of time \r\n    if (this.length != array.length)\r\n        return false;\r\n\r\n    for (var i = 0, l=this.length; i < l; i++) {\r\n        // Check if we have nested arrays\r\n        if (this[i] instanceof Array && array[i] instanceof Array) {\r\n            // recurse into the nested arrays\r\n            if (!this[i].equals(array[i]))\r\n                return false;       \r\n        }           \r\n        else if (this[i] != array[i]) { \r\n            // Warning - two different object instances will never be equal: {x:20} != {x:20}\r\n            return false;   \r\n        }           \r\n    }       \r\n    return true;\r\n}\r\n\r\n\r\nclass ButtonImportXLS extends Component {\r\n\r\n    _index = 0 ;\r\n    _percentage = 0 ;\r\n\r\n    constructor(props){\r\n        super(props);\r\n\r\n        this.state = {\r\n            status:'',\r\n            columns:props.columns,\r\n\r\n            isOpen:false\r\n        }\r\n\r\n        this.grid = {\r\n            colums:[\r\n            ],\r\n            rowData:[]\r\n        }\r\n\r\n        this._setup();\r\n    }\r\n\r\n    _setup(){\r\n\r\n        // FORMAT GRID COLUM\r\n        this.state.columns.map((item)=>{\r\n            this.grid.colums.push({\r\n                headerName:item,\r\n                field:item,\r\n                width:'140px'\r\n            });\r\n        });\r\n\r\n        this.model = new Model(this.props.strModel);\r\n\r\n\r\n    }\r\n\r\n    _openForm(){\r\n        this.setState({\r\n            isOpen:true\r\n        });\r\n\r\n    }\r\n    _compareColumns(columns=[]){\r\n        \r\n        return columns.equals(this.state.columns)\r\n    }\r\n    _handleFile(e){\r\n        if (e.target.files && e.target.files.length > 0) {\r\n            \r\n            let msg = 'Định dạng cột trong tập tin Excel không hợp lệ';\r\n\r\n            const reader = new FileReader();\r\n            reader.readAsArrayBuffer(e.target.files[0]);\r\n    \r\n            reader.onload = (e)=>{\r\n\r\n              const data = new Uint8Array(reader.result);\r\n              const wb = XLSX.read(data,{type:'array'});\r\n    \r\n              const sheetName  = wb.SheetNames[0];\r\n              const worksheet = wb.Sheets[sheetName];\r\n              \r\n              const list = XLSX.utils.sheet_to_json(worksheet,{raw:true});\r\n              \r\n              if(list.length>0){\r\n                if(this._compareColumns(Object.keys(list[0]))){\r\n                    this.grid.rowData = list ; \r\n                    this._openForm() ; \r\n                    msg = '';\r\n                }\r\n              }\r\n\r\n\r\n              if(msg!==''){\r\n                 BenMessage({\r\n                     message:msg\r\n                 });\r\n              }\r\n              \r\n    \r\n          }\r\n        }\r\n    }\r\n    \r\n    _uploadNow(){\r\n        const data = this.grid.rowData[this._index]; \r\n        \r\n\r\n        if(this._index < this.grid.rowData.length){\r\n\r\n            this.model.axios('post',data,(res)=>{\r\n                this._index +=1 ;\r\n                this._percentage = (this._index * 100)/this.grid.rowData.length;\r\n                \r\n                this.setState({\r\n                    status:res.name\r\n                });\r\n\r\n                this._uploadNow();\r\n            })\r\n            \r\n        }else{ \r\n\r\n            BenMessage({\r\n                message:'Đã upload thành công'\r\n            });\r\n            \r\n            this.setState({\r\n                status:'finish',\r\n                isOpen:false\r\n            });\r\n\r\n            this.props.onComplete(true);\r\n        }\r\n        \r\n    }\r\n    _onSubmit = ()=>{\r\n        \r\n        this._index = 0 ;\r\n        this._percentage = 0 ;\r\n        this._uploadNow();\r\n        \r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Button style={this.props.style} className=\"btn btn-normal\">\r\n                <ViewModal  \r\n                    width={this.props.width}\r\n                    name={this.props.strModel}\r\n                    isOpen={ this.state.isOpen }\r\n                    onToggle={(isOpen)=>{  this.setState({isOpen:isOpen})  }}\r\n                >\r\n                    <div className=\"view-modal-body\">\r\n                        <BenTable\r\n                            height={this.props.height}\r\n                            grid={this.grid}\r\n                        />\r\n                        <div style={{marginTop:20}}>\r\n                            \r\n                            <Row>\r\n                                <Col md={1}>\r\n                                    <Button onClick={ this._onSubmit } className=\"btn btn-normal bg-green\">\r\n                                        <i className=\"fa fa-cloud-upload\"></i> Tải lên\r\n                                    </Button>\r\n                                </Col>\r\n                                <Col md={11} style={{\r\n                                    margin:'auto'\r\n                                }}>\r\n                                    <div style={{display: this.state.status ==='' ? 'none':'block' }} className=\"progress progress-sm \">\r\n                                        <div \r\n                                            className=\"progress-bar progress-bar-success progress-bar-striped\" \r\n                                            style={{width:  this._percentage+'%' }}>\r\n                                            <span> { Math.floor(this._percentage) + '%' } Complete</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </Col>\r\n                            </Row>\r\n                            \r\n                            \r\n\r\n                        </div>\r\n                    </div>\r\n                </ViewModal>\r\n\r\n                <i className={this.props.icon}></i> { this.props.title }    \r\n                <Input \r\n                    accept=\".xlsx\"\r\n                    style={{width: '100%',height: 50,position: 'absolute', top:0, left: 15, opacity: 0}} id=\"photo\" type=\"file\" onChange={ (e)=> { this._handleFile(e) } } >\r\n                </Input>\r\n            </Button>            \r\n        );\r\n    }\r\n}\r\n\r\nButtonImportXLS.defaultProps = {\r\n\r\n    onComplete:(isSuccess)=>{},\r\n    strModel:'products',\r\n    columns:['code','name','type','supplier_codes','price_1','price_2','price_3','price_4','is_serial'],\r\n    \r\n    icon:\"fa fa-cloud-upload mr-5\",\r\n    title:'.xlsx',\r\n    width:'81%',\r\n    height:'55vh'\r\n}\r\n\r\nexport default ButtonImportXLS;"]},"metadata":{},"sourceType":"module"}